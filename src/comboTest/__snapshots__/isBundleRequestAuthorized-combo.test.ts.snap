// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 0",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Observation.read",
        "user/Observation.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.read",
        "system/Patient.write",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Patient.write",
        "user/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `undefined`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 1",
  "request": {
    "userIdentity": {
      "scopes": [],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 2",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Observation.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/Observation.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/Observation.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 3",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Patient.write",
        "user/Observation.write",
        "user/Condition.write",
        "system/Patient.write",
        "system/Observation.write",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Patient.write",
        "user/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 4",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Observation.write",
        "patient/Condition.read",
        "user/Patient.write",
        "user/Observation.read",
        "user/Condition.write",
        "system/Patient.read",
        "system/Observation.write",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 5",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Observation.write",
        "user/Condition.read",
        "system/Patient.write",
        "system/Observation.read",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 6",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 7",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Observation.read",
        "patient/Observation.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Observation.read",
        "user/Observation.write",
        "system/Patient.read",
        "system/Patient.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write",
        "user/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 8",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Observation.write",
        "system/Patient.write",
        "system/Observation.read",
        "system/Observation.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Condition.write",
        "user/Patient.write",
        "user/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 9",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Observation.write",
        "user/Observation.read",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.read",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `undefined`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 10",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Observation.write",
        "user/Patient.read",
        "user/Observation.write",
        "user/Condition.read",
        "system/Patient.read",
        "system/Observation.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "user/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 11",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Observation.read",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Patient.write",
        "user/Observation.read",
        "user/Condition.write",
        "system/Patient.write",
        "system/Observation.read",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Condition.write",
        "user/Patient.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 12",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Observation.read",
        "user/Patient.write",
        "user/Observation.write",
        "user/Condition.write",
        "system/Patient.read",
        "system/Observation.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write",
        "user/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 13",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Observation.write",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Observation.read",
        "user/Condition.read",
        "system/Patient.write",
        "system/Observation.write",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 14",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Observation.write",
        "system/Patient.read",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 15",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Observation.read",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.write",
        "system/Observation.read",
        "system/Observation.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 16",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Observation.read",
        "user/Observation.write",
        "user/Condition.read",
        "system/Observation.read",
        "system/Observation.write"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Observation.write",
        "patient/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 17",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Condition.read",
        "user/Patient.read",
        "user/Patient.write",
        "user/Condition.write",
        "system/Patient.read",
        "system/Patient.write",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 18",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Observation.read",
        "system/Patient.read",
        "system/Observation.write",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 19",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Observation.write",
        "patient/Condition.read",
        "user/Observation.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.write",
        "system/Observation.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 20",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Condition.read",
        "system/Patient.read",
        "system/Patient.write",
        "system/Observation.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 21",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Observation.read",
        "patient/Condition.read",
        "user/Observation.read",
        "user/Observation.write",
        "user/Condition.write",
        "system/Observation.write",
        "system/Condition.write"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 22",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "user/Patient.write",
        "user/Observation.write",
        "user/Condition.read",
        "system/Patient.read",
        "system/Patient.write",
        "system/Observation.write",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 23",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Observation.read",
        "user/Condition.write",
        "system/Observation.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 24",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Observation.read",
        "user/Observation.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "user/Patient.write",
        "user/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `undefined`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 25",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.read",
        "patient/Condition.write",
        "system/Patient.read",
        "system/Patient.write",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.write"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Observation.write",
        "patient/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `undefined`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 26",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Patient.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `undefined`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 27",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Condition.read",
        "user/Observation.read",
        "user/Observation.write",
        "system/Patient.read",
        "system/Patient.write",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "user/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 28",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Observation.read",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.read",
        "system/Patient.write"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 29",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Observation.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Observation.write",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 30",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Observation.write",
        "user/Observation.read",
        "system/Patient.write",
        "system/Observation.write",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 31",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Observation.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.read",
        "system/Observation.read",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write",
        "user/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 32",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.write",
        "user/Observation.read",
        "user/Observation.write",
        "user/Condition.write",
        "system/Patient.read",
        "system/Patient.write",
        "system/Observation.read",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `undefined`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 33",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.read",
        "user/Patient.read",
        "user/Patient.write",
        "user/Condition.read",
        "system/Observation.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 34",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.read",
        "user/Patient.read",
        "user/Patient.write",
        "user/Observation.read",
        "user/Observation.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.write",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 35",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Condition.write",
        "system/Patient.read",
        "system/Observation.read",
        "system/Observation.write"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 36",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Observation.read",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Observation.write",
        "user/Condition.write",
        "system/Patient.read",
        "system/Patient.write",
        "system/Observation.write",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Condition.write",
        "user/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `undefined`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 37",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "patient/Condition.read",
        "user/Patient.write",
        "user/Observation.read",
        "user/Condition.read",
        "system/Observation.read",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "user/Patient.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 38",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.read",
        "user/Patient.write",
        "system/Patient.read",
        "system/Patient.write",
        "system/Observation.read",
        "system/Condition.write"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 39",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Condition.write",
        "user/Patient.read",
        "user/Observation.read",
        "user/Observation.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Observation.write",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 40",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.read",
        "user/Patient.read",
        "user/Observation.write",
        "user/Condition.write",
        "system/Observation.read",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `undefined`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 41",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Condition.write",
        "user/Patient.write",
        "user/Observation.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/Patient.write",
        "system/Observation.write",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 42",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Observation.read",
        "user/Patient.read",
        "user/Observation.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.read",
        "system/Condition.write"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 43",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Observation.write",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Patient.write",
        "user/Observation.read",
        "system/Patient.write",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 44",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Observation.read",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.write"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "patient/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `undefined`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 45",
  "request": {
    "userIdentity": {
      "scopes": [
        "user/Patient.read",
        "user/Patient.write",
        "user/Observation.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.read",
        "system/Patient.write",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write",
        "user/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 46",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Patient.write",
        "user/Observation.read",
        "user/Observation.write",
        "user/Condition.read",
        "system/Patient.write",
        "system/Observation.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write",
        "user/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 47",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/Condition.write",
        "system/Patient.read",
        "system/Observation.write",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 48",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Observation.read",
        "user/Condition.write",
        "system/Observation.read",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 49",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Condition.read",
        "user/Patient.write",
        "user/Observation.write",
        "user/Condition.read",
        "system/Patient.read",
        "system/Patient.write",
        "system/Observation.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write",
        "user/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 50",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Patient.write",
        "user/Observation.read",
        "user/Observation.write",
        "user/Condition.read",
        "user/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Patient.write",
        "user/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 51",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "user/Patient.read",
        "system/Patient.read",
        "system/Patient.write",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 52",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Observation.write",
        "patient/Condition.read",
        "user/Observation.read",
        "user/Observation.write",
        "system/Patient.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 53",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Observation.read",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.write",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.write"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 54",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Observation.read",
        "patient/Observation.write",
        "user/Observation.read",
        "user/Condition.read",
        "system/Patient.read",
        "system/Observation.read",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 55",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Observation.write",
        "user/Condition.write",
        "system/Patient.write",
        "system/Observation.write"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 56",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Observation.read",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.read",
        "system/Observation.read",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Condition.write",
        "user/Patient.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 57",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Observation.read",
        "patient/Observation.write",
        "user/Observation.write",
        "system/Patient.write",
        "system/Observation.write",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Observation.write",
        "user/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 58",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Observation.write",
        "system/Patient.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 59",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Observation.write",
        "patient/Condition.read",
        "user/Patient.write",
        "user/Observation.read",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.write",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 60",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Observation.read",
        "patient/Condition.write",
        "user/Patient.read",
        "system/Patient.read",
        "system/Patient.write",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 61",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "patient/Condition.read",
        "user/Patient.write",
        "user/Observation.read",
        "user/Observation.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.write"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 62",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Observation.read",
        "patient/Observation.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.read",
        "system/Patient.write",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 63",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Observation.read",
        "user/Observation.write",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 64",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Observation.read",
        "user/Observation.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.read",
        "system/Patient.write",
        "system/Observation.write",
        "system/Condition.write"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "patient/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `undefined`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 65",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Observation.read",
        "patient/Condition.read",
        "user/Patient.write",
        "system/Observation.read",
        "system/Condition.read"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 66",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.read",
        "user/Patient.read",
        "user/Patient.write",
        "user/Observation.read",
        "user/Observation.write",
        "user/Condition.write",
        "system/Patient.read",
        "system/Patient.write",
        "system/Observation.write",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "user/Patient.write",
        "user/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `undefined`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 67",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Condition.write",
        "user/Condition.read",
        "system/Observation.read",
        "system/Condition.read"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 68",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/Patient.write",
        "user/Observation.read",
        "user/Observation.write",
        "system/Patient.write",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write",
        "user/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 69",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.read",
        "system/Observation.read",
        "system/Observation.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 70",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Observation.read",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Observation.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.write",
        "system/Observation.write",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 71",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Observation.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Observation.read",
        "system/Patient.read",
        "system/Observation.read",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 72",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.read",
        "user/Patient.read",
        "user/Patient.write",
        "user/Condition.read",
        "system/Patient.read",
        "system/Patient.write",
        "system/Observation.write"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 73",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Condition.write",
        "user/Observation.read",
        "user/Observation.write",
        "user/Condition.write",
        "system/Observation.read",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "usableScopes": []
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 74",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Patient.write",
        "user/Observation.read",
        "user/Observation.write",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write",
        "user/Observation.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 75",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Condition.read",
        "user/Patient.read",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.read",
        "system/Patient.write",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "usableScopes": [
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 76",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Observation.read",
        "user/Observation.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.read",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 77",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Condition.read",
        "user/Patient.write",
        "system/Patient.write",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 78",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Observation.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Condition.read",
        "system/Patient.read",
        "system/Patient.write",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Observation.write",
        "user/Patient.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 79",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Observation.read",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Observation.read",
        "user/Observation.write",
        "user/Condition.write",
        "system/Observation.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Condition.write",
        "user/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 80",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Observation.write",
        "user/Condition.write",
        "system/Patient.read",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.read",
        "system/Condition.write"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "patient/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `undefined`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 81",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Condition.read",
        "system/Patient.write"
      ],
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "N/A",
    "system/Patient.read": "N/A",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 82",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Observation.read",
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Observation.read",
        "user/Condition.write",
        "system/Observation.write",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Observation.write",
        "patient/Condition.write",
        "user/Patient.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "N/A",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "N/A",
    "system/Patient.write": "N/A",
    "system/Observation.read": "N/A",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `undefined`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 83",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "patient/Condition.read",
        "user/Observation.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.read",
        "system/Patient.write",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Practitioner",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Patient.write",
        "patient/Observation.write",
        "user/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://random.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "practitionerFhirUser",
    "fhirServiceBaseUrl": "nonMatchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "N/A",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "N/A",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 84",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Patient.read",
        "patient/Patient.write",
        "patient/Observation.write",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Patient.read",
        "user/Patient.write",
        "user/Condition.write",
        "system/Patient.read",
        "system/Observation.read",
        "system/Observation.write",
        "system/Condition.read"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "user/Patient.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "patient/Patient.read",
    "patient/Patient.write": "patient/Patient.write",
    "patient/Observation.read": "N/A",
    "patient/Observation.write": "patient/Observation.write",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "user/Patient.read",
    "user/Patient.write": "user/Patient.write",
    "user/Observation.read": "N/A",
    "user/Observation.write": "N/A",
    "user/Condition.read": "N/A",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "N/A",
    "system/Observation.read": "system/Observation.read",
    "system/Observation.write": "system/Observation.write",
    "system/Condition.read": "system/Condition.read",
    "system/Condition.write": "N/A"
  }
} 1`] = `[UnauthorizedError: An entry within the Bundle is not authorized]`;

exports[`isBundleRequestAuthorized-BulkDataAuth-combo CASE: {
  "testName": "Combo Test Row 85",
  "request": {
    "userIdentity": {
      "scopes": [
        "patient/Observation.read",
        "patient/Condition.read",
        "patient/Condition.write",
        "user/Observation.read",
        "user/Observation.write",
        "user/Condition.read",
        "user/Condition.write",
        "system/Patient.read",
        "system/Patient.write",
        "system/Condition.write"
      ],
      "fhirUserObject": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "patientLaunchContext": {
        "hostname": "https://fhir.server.com/dev",
        "resourceType": "Patient",
        "id": "id"
      },
      "usableScopes": [
        "patient/Condition.write",
        "user/Observation.write",
        "user/Condition.write"
      ]
    },
    "fhirServiceBaseUrl": "https://fhir.server.com/dev",
    "requests": [
      {
        "operation": "create",
        "resourceType": "Observation",
        "id": "1274045",
        "resource": {
          "resourceType": "Observation",
          "id": "1274045",
          "meta": {
            "versionId": "1",
            "lastUpdated": "2020-06-28T12:55:47.134+00:00"
          },
          "status": "final",
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "15074-8",
                "display": "Glucose [Moles/volume] in Blood"
              }
            ]
          },
          "subject": {
            "reference": "https://fhir.server.com/dev/Patient/id",
            "display": "JONNY"
          },
          "effectivePeriod": {
            "start": "2013-04-02T09:30:10+01:00"
          },
          "issued": "2013-04-03T15:30:10+01:00",
          "valueQuantity": {
            "value": 6.3,
            "unit": "mmol/l",
            "system": "http://unitsofmeasure.org",
            "code": "mmol/L"
          },
          "interpretation": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation",
                  "code": "H",
                  "display": "High"
                }
              ]
            }
          ],
          "referenceRange": [
            {
              "low": {
                "value": 3.1,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              },
              "high": {
                "value": 6.2,
                "unit": "mmol/l",
                "system": "http://unitsofmeasure.org",
                "code": "mmol/L"
              }
            }
          ]
        },
        "references": [
          {
            "resourceType": "Patient",
            "id": "Patient/id",
            "vid": "1",
            "rootUrl": "https://fhir.server.com/dev",
            "referenceFullUrl": "https://fhir.server.com/dev/Patient/id",
            "referencePath": "subject"
          }
        ]
      },
      {
        "operation": "create",
        "resourceType": "Condition",
        "id": "example",
        "resource": {
          "resourceType": "Condition",
          "id": "example",
          "text": {
            "status": "generated",
            "div": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Severe burn of left ear (Date: 24-May 2012)</div>"
          },
          "clinicalStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                "code": "active"
              }
            ]
          },
          "verificationStatus": {
            "coding": [
              {
                "system": "http://terminology.hl7.org/CodeSystem/condition-ver-status",
                "code": "confirmed"
              }
            ]
          },
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-category",
                  "code": "encounter-diagnosis",
                  "display": "Encounter Diagnosis"
                },
                {
                  "system": "http://snomed.info/sct",
                  "code": "439401001",
                  "display": "Diagnosis"
                }
              ]
            }
          ],
          "severity": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "24484000",
                "display": "Severe"
              }
            ]
          },
          "code": {
            "coding": [
              {
                "system": "http://snomed.info/sct",
                "code": "39065001",
                "display": "Burn of ear"
              }
            ],
            "text": "Burnt Ear"
          },
          "bodySite": [
            {
              "coding": [
                {
                  "system": "http://snomed.info/sct",
                  "code": "49521004",
                  "display": "Left external ear structure"
                }
              ],
              "text": "Left Ear"
            }
          ],
          "onsetDateTime": "2012-05-24"
        }
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "id"
      },
      {
        "operation": "read",
        "resourceType": "Patient",
        "id": "PatientNotSameId"
      }
    ]
  },
  "rawCsvRow": {
    "patientContext": "patientIdentity",
    "fhirUser": "patientFhirUser",
    "fhirServiceBaseUrl": "matchUrl",
    "patient/Patient.read": "N/A",
    "patient/Patient.write": "N/A",
    "patient/Observation.read": "patient/Observation.read",
    "patient/Observation.write": "N/A",
    "patient/Condition.read": "patient/Condition.read",
    "patient/Condition.write": "patient/Condition.write",
    "user/Patient.read": "N/A",
    "user/Patient.write": "N/A",
    "user/Observation.read": "user/Observation.read",
    "user/Observation.write": "user/Observation.write",
    "user/Condition.read": "user/Condition.read",
    "user/Condition.write": "user/Condition.write",
    "system/Patient.read": "system/Patient.read",
    "system/Patient.write": "system/Patient.write",
    "system/Observation.read": "N/A",
    "system/Observation.write": "N/A",
    "system/Condition.read": "N/A",
    "system/Condition.write": "system/Condition.write"
  }
} 1`] = `undefined`;
